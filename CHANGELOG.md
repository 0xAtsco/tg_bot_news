# Changelog

## 2025-12-14 - Улучшения перевода и форматирования

### Что исправлено

#### 1. Загрузка полного текста статей
- **Проблема**: Бот переводил только краткий summary из RSS (обычно 200-300 символов)
- **Решение**: Теперь бот загружает полный текст статьи с оригинального URL
- **Результат**: DOCX файлы содержат полный перевод всей статьи (2000+ символов)

#### 2. Профессиональное форматирование DOCX
- **Проблема**: DOCX был нечитаемым - один сплошной текст без структуры
- **Решение**: Добавлено умное форматирование:
  - Красивый заголовок (18pt, жирный)
  - Метаданные с выделением (дата, тип, ссылка)
  - Автоматическое определение заголовков разделов
  - Маркированные и нумерованные списки
  - Ссылки (синие, подчеркнутые)
  - Временные метки для подкастов
  - Нормальные абзацы с межстрочным интервалом
- **Результат**: DOCX файлы теперь легко читать и они выглядят профессионально

#### 3. Улучшенная надежность
- **Добавлено**: Retry логика для Telegram API (3 попытки)
- **Добавлено**: Retry логика для загрузки статей (3 попытки)
- **Улучшено**: Retry логика для OpenRouter API с экспоненциальной задержкой
- **Результат**: Бот устойчив к временным сбоям сети

#### 4. Улучшенный перевод
- **Улучшено**: Промпты для OpenRouter API теперь более строгие
- **Результат**: TLDR всегда на русском языке, без английских слов
- **Результат**: Пропускаются дисклаймеры и реклама в TLDR

### Новые зависимости

```bash
beautifulsoup4>=4.12.0  # Для парсинга HTML
html2text>=2020.1.16     # Для очистки HTML
```

### Новые файлы

- `messari_tg_bot/src/article_fetcher.py` - Модуль для загрузки полного текста статей

### Измененные файлы

- `messari_tg_bot/src/docx_renderer.py` - Добавлено профессиональное форматирование
- `messari_tg_bot/src/telegram_client.py` - Добавлена retry логика
- `messari_tg_bot/src/translator.py` - Улучшены промпты и добавлена retry логика
- `messari_tg_bot/src/orchestrator.py` - Интеграция загрузки полных статей
- `messari_tg_bot/src/main.py` - Добавлен ArticleFetcher

### Как обновить

```bash
cd /Users/absq/Desktop/deAI/tg_bot_news
source .venv/bin/activate
pip install beautifulsoup4 html2text
```

Готово! Бот теперь работает намного лучше.
